<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ピンホールカメラ計算機</title>
  <style>
    :root {
      --accent: #2299ff;
      --accent-soft: rgba(34, 153, 255, 0.06);
      --accent-soft-strong: rgba(34, 153, 255, 0.12);
      --accent-border: rgba(34, 153, 255, 0.9);
    }

    * {
      box-sizing: border-box;
    }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      margin: 0;
      padding: 16px 10px 28px;
      background: #ffffff; /* 背景は無地 */
      color: #111827;
    }
    .app-shell {
      max-width: 900px;
      margin: 0 auto;
    }
    .card {
      background: #ffffff;
      border-radius: 18px;
      box-shadow:
        0 10px 26px rgba(15, 23, 42, 0.08),
        0 0 0 1px rgba(148, 163, 184, 0.25);
      padding: 16px 16px 20px;
    }

    .app-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 14px;
    }
    .header-left {
      display: flex;
      align-items: center;
      gap: 10px;
      min-width: 0;
    }
    .app-icon {
      width: 30px;
      height: 30px;
      border-radius: 11px;
      background: linear-gradient(145deg, var(--accent), #59b3ff);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #ecfeff;
      font-weight: 800;
      font-size: 0.95rem;
      box-shadow: 0 4px 10px rgba(34, 153, 255, 0.4);
      flex-shrink: 0;
    }
    h1 {
      font-size: 1.25rem;
      margin: 0;
    }
    .app-subtitle {
      font-size: 0.82rem;
      color: #4b5563;
      margin-top: 2px;
    }

    .lang-switch {
      display: flex;
      gap: 6px;
      flex-shrink: 0;
    }
    .lang-btn {
      border-radius: 999px;
      border: 1px solid #d1d5db;
      background: #f9fafb;
      padding: 4px 10px;
      font-size: 0.78rem;
      cursor: pointer;
      color: #374151;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .lang-btn.active {
      border-color: var(--accent-border);
      background: var(--accent-soft);
      color: #1d4ed8;
    }

    .layout-grid {
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2.4fr);
      gap: 12px;
      margin-top: 10px;
    }
    @media (max-width: 800px) {
      .layout-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    fieldset {
      margin: 0;
      padding: 10px 10px 12px;
      border-radius: 14px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
    }
    legend {
      font-weight: 600;
      padding: 0 4px;
      font-size: 0.84rem;
      color: #111827;
    }

    label {
      display: block;
      margin-top: 8px;
      font-size: 0.82rem;
      color: #374151;
    }
    input, select {
      padding: 6px 8px;
      margin-top: 3px;
      min-width: 80px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      font-size: 0.87rem;
      background: #f9fafb;
      transition: border-color 0.12s, box-shadow 0.12s, background 0.12s;
    }
    input:focus, select:focus {
      outline: none;
      border-color: var(--accent-border);
      box-shadow: 0 0 0 1px var(--accent-soft-strong);
      background: #ffffff;
    }
    .inline {
      display: inline-block;
      margin-right: 14px;
    }
    small {
      color: #6b7280;
      font-size: 0.74rem;
    }

    /* ---- モード選択カード ---- */
    .mode-card {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      margin-top: 8px;
      padding: 8px 10px;
      border-radius: 12px;
      transition: background 0.12s, border-color 0.12s, box-shadow 0.12s, transform 0.06s;
      border: 1px solid #e5e7eb;
      cursor: pointer;
    }
    .mode-card input[type="radio"] {
      display: none;
    }
    .mode-card-title {
      font-size: 0.85rem;
      font-weight: 600;
      color: #111827;
    }
    .mode-card-desc {
      font-size: 0.78rem;
      color: #6b7280;
      margin-top: 2px;
    }
    .mode-card-indicator {
      width: 16px;
      height: 16px;
      border-radius: 999px;
      border: 2px solid rgba(148, 163, 184, 0.7);
      margin-top: 2px;
      flex-shrink: 0;
      position: relative;
      background: #ffffff;
    }
    .mode-card-indicator::after {
      content: "";
      position: absolute;
      inset: 3px;
      border-radius: 999px;
      background: var(--accent);
      opacity: 0;
      transition: opacity 0.12s;
    }
    .mode-card.active {
      border-color: var(--accent-border);
      background: var(--accent-soft);
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.08);
      transform: translateY(-0.5px);
    }
    .mode-card.active .mode-card-indicator {
      border-color: var(--accent-border);
      background: #eff6ff;
    }
    .mode-card.active .mode-card-indicator::after {
      opacity: 1;
    }

    .mode-block {
      margin-left: 22px;
      margin-top: 6px;
      padding: 6px 8px 8px;
      border-radius: 10px;
      background: #f3f4f6;
      border: 1px dashed #e5e7eb;
      transition: opacity 0.15s;
      display: none;
    }

    button {
      margin-top: 12px;
      padding: 9px 20px;
      cursor: pointer;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, var(--accent), #59b3ff);
      color: #fff;
      font-weight: 600;
      font-size: 0.95rem;
      box-shadow:
        0 7px 16px rgba(34, 153, 255, 0.4),
        0 0 0 1px rgba(15, 23, 42, 0.05);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 96px;
    }
    button:hover {
      background: linear-gradient(135deg, #2089e1, var(--accent));
      transform: translateY(-0.5px);
    }
    button:active {
      transform: translateY(0.4px);
      box-shadow:
        0 4px 10px rgba(34, 153, 255, 0.4),
        0 0 0 1px rgba(15, 23, 42, 0.05);
    }

    .result {
      margin-top: 0;
      padding: 12px 12px 14px;
      border-radius: 14px;
      border: 1px solid #e2e8f0;
      background: #f9fafb;
      font-size: 0.9rem;
      min-height: 3em;
      white-space: normal;
    }

    /* ---- 結果カードUI ---- */
    .result-section {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .result-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(34, 153, 255, 0.08);
      color: #0f172a;
      font-size: 0.78rem;
      border: 1px solid rgba(34, 153, 255, 0.3);
    }
    .chip span.label {
      font-weight: 600;
      opacity: 0.8;
    }

    .mode-detail {
      margin: 0;
      font-size: 0.8rem;
      color: #4b5563;
    }

    .section-title {
      margin-top: 4px;
      margin-bottom: 4px;
      font-size: 0.86rem;
      font-weight: 600;
      color: #111827;
    }

    .result-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 9px;
      margin-top: 4px;
    }

    .result-card {
      border-radius: 10px;
      padding: 9px 11px;
      background: #ffffff;
      border: 1px solid #e5e7eb;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    /* 焦点距離カードも他と同じトーンに揃える */
    .result-card.main {
      /* 特別な色付けはしない */
    }

    .result-label {
      font-size: 0.76rem;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      color: #6b7280;
    }

    .result-value {
      font-size: 1.16rem;
      font-weight: 600;
      display: flex;
      align-items: baseline;
      gap: 4px;
    }
    .unit {
      font-size: 0.8rem;
      opacity: 0.8;
    }
    .result-sub {
      font-size: 0.76rem;
      color: #6b7280;
    }

    .angle-badge {
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      color: #6b7280;
    }

    .placeholder-text {
      font-size: 0.82rem;
      color: #9ca3af;
    }

    /* ---- スマホ向け調整 ---- */
    @media (max-width: 600px) {
      body {
        padding: 12px 8px 22px;
      }
      .card {
        padding: 14px 12px 18px;
        border-radius: 16px;
      }
      .app-header {
        flex-direction: column;
        align-items: stretch;
        gap: 8px;
      }
      .lang-switch {
        justify-content: flex-end;
      }
      .layout-grid {
        gap: 10px;
      }
      .inline {
        display: block;
        margin-right: 0;
      }
      input, select {
        width: 100%;
      }
      .mode-block {
        margin-left: 0;
      }
      fieldset {
        padding: 10px 8px 12px;
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <div class="card">
      <header class="app-header">
        <div class="header-left">
          <div class="app-icon">P</div>
          <div>
            <h1 data-i18n="title">ピンホールカメラ計算機</h1>
            <div class="app-subtitle" data-i18n="subtitle">
              画角・焦点距離・ピンホール径・35mm換算をまとめて設計
            </div>
          </div>
        </div>
        <div class="lang-switch">
          <button class="lang-btn active" data-lang="ja">日本語</button>
          <button class="lang-btn" data-lang="en">English</button>
        </div>
      </header>

      <div class="layout-grid">
        <!-- 左：入力エリア -->
        <div>
          <fieldset>
            <legend data-i18n="legendCommon">共通パラメータ</legend>

            <label class="inline">
              <span data-i18n="widthLabel">フィルム／印画紙 横幅 W（mm）</span>
              <br /><input id="widthMm" type="number" step="0.1" value="190" />
            </label>

            <label class="inline">
              <span data-i18n="heightLabel">フィルム／印画紙 縦幅 H（mm）</span>
              <br /><input id="heightMm" type="number" step="0.1" value="140" />
            </label>

            <label class="inline">
              <span data-i18n="lambdaLabel">光の波長 λ（nm）</span>
              <br /><input id="lambdaNm" type="number" step="1" value="500" />
            </label>
          </fieldset>

          <fieldset style="margin-top:12px;">
            <legend data-i18n="legendMode">計算モード</legend>

            <label class="mode-card" data-mode="fov">
              <span class="mode-card-indicator"></span>
              <div>
                <div class="mode-card-title" data-i18n="modeFovTitle">画角から設計</div>
                <div class="mode-card-desc" data-i18n="modeFovDesc">
                  欲しい画角（水平・垂直・対角）から、焦点距離とピンホール径を求めます。
                </div>
              </div>
              <input type="radio" name="mode" value="fov" />
            </label>
            <div id="modeFovBlock" class="mode-block">
              <label class="inline">
                <span data-i18n="fovDirectionLabel">画角の向き</span>
                <br />
                <select id="fovType">
                  <option value="diagonal" data-i18n="fovDiagonal">対角画角</option>
                  <option value="horizontal" data-i18n="fovHorizontal">水平画角</option>
                  <option value="vertical" data-i18n="fovVertical">垂直画角</option>
                </select>
              </label>

              <label class="inline">
                <span data-i18n="fovValueLabel">目標画角 θ（度）</span>
                <br /><input id="fovDeg" type="number" step="0.1" value="60" />
              </label>
            </div>

            <label class="mode-card" data-mode="eq35" style="margin-top:10px;">
              <span class="mode-card-indicator"></span>
              <div>
                <div class="mode-card-title" data-i18n="modeEqTitle">35mm換算焦点距離から設計</div>
                <div class="mode-card-desc" data-i18n="modeEqDesc">
                  「このフォーマットでフルサイズ35mmの◯◯mm相当の画角が欲しい」というときに使います。
                </div>
              </div>
              <input type="radio" name="mode" value="eq35" />
            </label>
            <div id="modeEq35Block" class="mode-block">
              <label class="inline">
                <span data-i18n="eq35Label">35mm換算 焦点距離 f<sub>eq</sub>（mm）</span>
                <br /><input id="fEqMm" type="number" step="0.1" value="50" />
              </label>
            </div>

            <label class="mode-card" data-mode="hole" style="margin-top:10px;">
              <span class="mode-card-indicator"></span>
              <div>
                <div class="mode-card-title" data-i18n="modeHoleTitle">ピンホール径から設計</div>
                <div class="mode-card-desc" data-i18n="modeHoleDesc">
                  すでに開いている穴の大きさから、最適な焦点距離と画角を求めます。
                </div>
              </div>
              <input type="radio" name="mode" value="hole" />
            </label>
            <div id="modeHoleBlock" class="mode-block">
              <label class="inline">
                <span data-i18n="holeLabel">ピンホール径 d（mm）</span>
                <br /><input id="holeMm" type="number" step="0.01" value="1.00" />
              </label>
            </div>
          </fieldset>

          <button id="calcBtn" data-i18n-button="calcButton">計算</button>
        </div>

        <!-- 右：結果エリア -->
        <div>
          <div id="result" class="result">
            <div class="placeholder-text" data-i18n="placeholderMain">
              ここに設計結果が表示されます。
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script>
    (function () {
      var DIAG_35MM = Math.sqrt(36 * 36 + 24 * 24);

      var currentLang = "ja";
      var lastResult = null;

      var i18n = {
        ja: {
          title: "ピンホールカメラ計算機",
          subtitle: "画角・焦点距離・ピンホール径・35mm換算をまとめて設計",
          legendCommon: "共通パラメータ",
          legendMode: "計算モード",
          widthLabel: "フィルム／印画紙 横幅 W（mm）",
          heightLabel: "フィルム／印画紙 縦幅 H（mm）",
          lambdaLabel: "光の波長 λ（nm）",
          modeFovTitle: "画角から設計",
          modeFovDesc:
            "欲しい画角（水平・垂直・対角）から、焦点距離とピンホール径を求めます。",
          modeEqTitle: "35mm換算焦点距離から設計",
          modeEqDesc:
            "「このフォーマットでフルサイズ35mmの◯◯mm相当の画角が欲しい」というときに使います。",
          modeHoleTitle: "ピンホール径から設計",
          modeHoleDesc:
            "すでに開いている穴の大きさから、最適な焦点距離と画角を求めます。",
          fovDirectionLabel: "画角の向き",
          fovValueLabel: "目標画角 θ（度）",
          fovDiagonal: "対角画角",
          fovHorizontal: "水平画角",
          fovVertical: "垂直画角",
          eq35Label: "35mm換算 焦点距離 f<sub>eq</sub>（mm）",
          holeLabel: "ピンホール径 d（mm）",
          calcButton: "計算",
          placeholderMain: "ここに設計結果が表示されます。",
          errCommon:
            "フィルムサイズと波長 λ を正しく入力してください（すべて正の数）。",
          errSelectMode: "計算モードを選択してください。",
          errFovRange: "画角 θ は 0〜179度の範囲で入力してください。",
          errEq:
            "35mm換算焦点距離 f_eq を正しく入力してください（正の数）。",
          errHole: "ピンホール径 d を正しく入力してください（正の数）。",
          chipFormat: "フォーマット",
          chipLambda: "波長",
          chipMode: "モード",
          sectionDesign: "設計結果",
          sectionAngles: "この設計での画角",
          labelFocus: "焦点距離",
          labelHole: "ピンホール径",
          labelFNumber: "F値（目安）",
          labelEq35: "35mm換算焦点距離",
          subFocus: "ピンホール〜像面距離",
          subHole: "Wikipedia の r²/λ の最適条件",
          subFNumber: "露出計算のときはこの F値として扱う",
          subEq35: "フルサイズ35mmと同等の対角画角",
          angleH: "水平",
          angleV: "垂直",
          angleD: "対角",
          subAngleH: "横幅 W に対する画角",
          subAngleV: "縦幅 H に対する画角",
          subAngleD: "対角長に対する画角",
          modeLabelFov: "画角から設計",
          modeLabelEq: "35mm換算から設計",
          modeLabelHole: "ピンホール径から設計",
          modeDetailFov: function (oriWord, theta) {
            return (
              "指定した " +
              oriWord +
              "画角 θ = " +
              theta.toFixed(1) +
              "° を満たすように設計しました。"
            );
          },
          modeDetailEq: function (fEq) {
            return (
              "フルサイズ35mm換算 " +
              fEq.toFixed(1) +
              "mm と同じ対角画角になるように設計しました。"
            );
          },
          modeDetailHole: function (d) {
            return (
              "指定したピンホール径 d = " +
              d.toFixed(3) +
              "mm に対して最適な焦点距離と画角を求めました。"
            );
          },
        },
        en: {
          title: "Pinhole Camera Calculator",
          subtitle:
            "Design angle of view, focal length, pinhole size, and 35mm equivalent",
          legendCommon: "Common parameters",
          legendMode: "Calculation mode",
          widthLabel: "Film / paper width W (mm)",
          heightLabel: "Film / paper height H (mm)",
          lambdaLabel: "Wavelength λ (nm)",
          modeFovTitle: "Design from angle of view",
          modeFovDesc:
            "Choose a desired angle of view (horizontal, vertical, or diagonal) and compute focal length and pinhole size.",
          modeEqTitle: "Design from 35mm equivalent focal length",
          modeEqDesc:
            "Use when you want this format to match the diagonal field-of-view of a full-frame focal length.",
          modeHoleTitle: "Design from pinhole size",
          modeHoleDesc:
            "Start from an existing pinhole diameter and compute the optimal focal length and field of view.",
          fovDirectionLabel: "Angle direction",
          fovValueLabel: "Target AoV θ (deg)",
          fovDiagonal: "Diagonal AoV",
          fovHorizontal: "Horizontal AoV",
          fovVertical: "Vertical AoV",
          eq35Label: "35mm equiv. focal length f<sub>eq</sub> (mm)",
          holeLabel: "Pinhole diameter d (mm)",
          calcButton: "Calculate",
          placeholderMain: "The design result will be shown here.",
          errCommon:
            "Please enter positive values for film size and wavelength λ.",
          errSelectMode: "Please select a calculation mode.",
          errFovRange: "Angle θ must be between 0 and 179 degrees.",
          errEq:
            "Please enter a valid 35mm equivalent focal length f_eq (positive number).",
          errHole:
            "Please enter a valid pinhole diameter d (positive number).",
          chipFormat: "Format",
          chipLambda: "Wavelength",
          chipMode: "Mode",
          sectionDesign: "Design result",
          sectionAngles: "Angles with this design",
          labelFocus: "Focal length",
          labelHole: "Pinhole diameter",
          labelFNumber: "F-number (approx.)",
          labelEq35: "35mm equiv. focal length",
          subFocus: "Distance from pinhole to image plane",
          subHole: "Diffraction optimum d = 2√(fλ)",
          subFNumber: "Use this N as the f-number for exposure",
          subEq35: "Diagonal field of view equivalent to full-frame",
          angleH: "Horizontal",
          angleV: "Vertical",
          angleD: "Diagonal",
          subAngleH: "Angle along width W",
          subAngleV: "Angle along height H",
          subAngleD: "Angle along the diagonal",
          modeLabelFov: "From angle of view",
          modeLabelEq: "From 35mm equiv.",
          modeLabelHole: "From pinhole size",
          modeDetailFov: function (oriWord, theta) {
            return (
              "Designed to match " +
              oriWord +
              " angle θ = " +
              theta.toFixed(1) +
              "°."
            );
          },
          modeDetailEq: function (fEq) {
            return (
              "Designed to have the same diagonal field of view as a " +
              fEq.toFixed(1) +
              " mm full-frame lens."
            );
          },
          modeDetailHole: function (d) {
            return (
              "Computed the optimal focal length and field of view for a pinhole diameter d = " +
              d.toFixed(3) +
              " mm."
            );
          },
        },
      };

      var orientationNames = {
        ja: {
          horizontal: "水平",
          vertical: "垂直",
          diagonal: "対角",
        },
        en: {
          horizontal: "horizontal",
          vertical: "vertical",
          diagonal: "diagonal",
        },
      };

      function t(key) {
        var langTable = i18n[currentLang] || i18n.ja;
        return langTable[key] || i18n.ja[key] || "";
      }

      function $(id) {
        return document.getElementById(id);
      }

      function getMode() {
        var radios = document.getElementsByName("mode");
        for (var i = 0; i < radios.length; i++) {
          if (radios[i].checked) return radios[i].value;
        }
        return null;
      }

      function updateModeVisibility() {
        var mode = getMode();
        $("modeFovBlock").style.display = mode === "fov" ? "block" : "none";
        $("modeEq35Block").style.display = mode === "eq35" ? "block" : "none";
        $("modeHoleBlock").style.display = mode === "hole" ? "block" : "none";

        var cards = document.getElementsByClassName("mode-card");
        for (var i = 0; i < cards.length; i++) {
          var cardMode = cards[i].getAttribute("data-mode");
          if (cardMode === mode) {
            cards[i].classList.add("active");
          } else {
            cards[i].classList.remove("active");
          }
        }
      }

      function renderPlaceholder(messageKey) {
        var resultDiv = $("result");
        resultDiv.innerHTML =
          '<div class="placeholder-text">' + t(messageKey) + "</div>";
      }

      function renderResult() {
        var resultDiv = $("result");

        if (!lastResult) {
          renderPlaceholder("placeholderMain");
          return;
        }

        var r = lastResult;

        var formatText =
          "W " +
          r.widthMm.toFixed(1) +
          " mm × H " +
          r.heightMm.toFixed(1) +
          " mm (" +
          (currentLang === "ja" ? "対角 " : "diag ") +
          r.diagMm.toFixed(1) +
          " mm)";

        var modeLabel;
        var modeDetail;

        if (r.mode === "fov") {
          modeLabel = t("modeLabelFov");
          var oriWord = orientationNames[currentLang][r.fovType] || "";
          modeDetail = i18n[currentLang].modeDetailFov(oriWord, r.fovDeg);
        } else if (r.mode === "eq35") {
          modeLabel = t("modeLabelEq");
          modeDetail = i18n[currentLang].modeDetailEq(r.fEqMm);
        } else {
          modeLab
